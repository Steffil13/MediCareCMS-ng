<app-navigation-bar></app-navigation-bar>

<div class="page-content">
  <div class="container mt-4">

    <!-- Page Heading -->
    <h2 class="text-center">Edit {{ role }}</h2>

    <!-- Back Button -->
    <!-- <div class="mb-3">
      <button class="btn btn-secondary" (click)="goBack()">
        <i class="fa fa-arrow-left"></i> Back
      </button>
    </div> -->

    <!-- Edit Form -->
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" novalidate>
      
      <!-- First Name -->
      <div class="mb-3">
        <label for="firstName" class="form-label">First Name *</label>
        <input id="firstName" type="text" formControlName="firstName" class="form-control"
               [class.is-invalid]="f['firstName'].touched && f['firstName'].invalid" />
        <div *ngIf="f['firstName'].touched && f['firstName'].invalid" class="invalid-feedback">
          First Name is required.
        </div>
      </div>

      <!-- Last Name -->
      <div class="mb-3">
        <label for="lastName" class="form-label">Last Name *</label>
        <input id="lastName" type="text" formControlName="lastName" class="form-control"
               [class.is-invalid]="f['lastName'].touched && f['lastName'].invalid" />
        <div *ngIf="f['lastName'].touched && f['lastName'].invalid" class="invalid-feedback">
          Last Name is required.
        </div>
      </div>

      <!-- Email -->
      <div class="mb-3">
        <label for="email" class="form-label">Email *</label>
        <input id="email" type="email" formControlName="email" class="form-control"
               [class.is-invalid]="f['email'].touched && f['email'].invalid" />
        <div *ngIf="f['email'].touched && f['email'].invalid" class="invalid-feedback">
          Valid email is required.
        </div>
      </div>

      <!-- Gender -->
      <div class="mb-3">
        <label class="form-label d-block">Gender *</label>
        <div *ngFor="let g of ['Male','Female','Other']" class="form-check form-check-inline">
          <input class="form-check-input" type="radio" formControlName="gender" [value]="g" />
          <label class="form-check-label">{{ g }}</label>
        </div>
        <div *ngIf="f['gender'].touched && f['gender'].invalid" class="text-danger mt-1">
          Please select a gender.
        </div>
      </div>

      <!-- Contact -->
      <div class="mb-3">
        <label for="contact" class="form-label">Contact *</label>
        <input id="contact" type="text" formControlName="contact" class="form-control"
               [class.is-invalid]="f['contact'].touched && f['contact'].invalid" />
        <div *ngIf="f['contact'].touched && f['contact'].invalid" class="invalid-feedback">
          <span *ngIf="f['contact'].errors?.['required']">Contact is required.</span>
          <span *ngIf="f['contact'].errors?.['invalidPhone']">Invalid 10-digit phone number.</span>
        </div>
      </div>

      <!-- Address -->
      <div class="mb-3">
        <label for="addresss" class="form-label">Address *</label>
        <input id="addresss" type="text" formControlName="addresss" class="form-control"
               [class.is-invalid]="f['addresss'].touched && f['addresss'].invalid" />
        <div *ngIf="f['addresss'].touched && f['addresss'].invalid" class="invalid-feedback">
          <span *ngIf="f['addresss'].errors?.['required']">Address is required.</span>
          <span *ngIf="f['addresss'].errors?.['minlength']">Minimum 3 characters required.</span>
          <span *ngIf="f['addresss'].errors?.['invalidChars']">Only letters and numbers allowed.</span>
        </div>
      </div>

      <!-- Blood Group -->
      <div class="mb-3">
        <label for="bloodGroup" class="form-label">Blood Group *</label>
        <select id="bloodGroup" formControlName="bloodGroup" class="form-select"
                [class.is-invalid]="f['bloodGroup'].touched && f['bloodGroup'].invalid">
          <option value="" disabled>Select Blood Group</option>
          <option *ngFor="let bg of bloodGroups" [value]="bg">{{ bg }}</option>
        </select>
        <div *ngIf="f['bloodGroup'].touched && f['bloodGroup'].invalid" class="invalid-feedback">
          Blood Group is required.
        </div>
      </div>

      <!-- Date of Birth -->
      <div class="mb-3">
        <label for="dob" class="form-label">Date of Birth *</label>
        <input id="dob" type="date" formControlName="dob" class="form-control"
               [class.is-invalid]="f['dob'].touched && f['dob'].invalid" />
        <div *ngIf="f['dob'].touched && f['dob'].invalid" class="invalid-feedback">
          Invalid date or out of allowed age range.
        </div>
      </div>

      <!-- Doctor-specific fields -->
      <div *ngIf="role === 'Doctor'">
        <div class="mb-3">
          <label for="departmentId" class="form-label">Department *</label>
          <select id="departmentId" formControlName="departmentId" class="form-select"
                  [class.is-invalid]="f['departmentId'].touched && f['departmentId'].invalid">
            <option value="" disabled>Select Department</option>
            <option *ngFor="let dept of departments" [value]="dept.departmentId">
              {{ dept.departmentName }}
            </option>
          </select>
        </div>

        <div class="mb-3">
          <label for="doctorFee" class="form-label">Doctor Fee</label>
          <input id="doctorFee" type="number" formControlName="doctorFee" class="form-control" readonly />
        </div>
      </div>

      <!-- Active Checkbox -->
      <div class="form-check mb-3">
        <input type="checkbox" id="isActive" formControlName="isActive" class="form-check-input" />
        <label for="isActive" class="form-check-label">Active</label>
      </div>

      <!-- Submit & Cancel -->
      <button type="submit" class="btn btn-primary" [disabled]="submitting">
        {{ submitting ? 'Updating...' : 'Update' }}
      </button>
      <button type="button" class="btn btn-secondary ms-2" (click)="cancel()" [disabled]="submitting">
        Cancel
      </button>

    </form>
  </div>
</div>
