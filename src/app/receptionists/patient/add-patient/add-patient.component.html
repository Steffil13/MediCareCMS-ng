<app-navigation-bar></app-navigation-bar>

<div class="page-content">
    <div class="container mt-4">
        <h2 class="text-center">Add Patient</h2>

        <form (ngSubmit)="onSubmit()" #patientForm="ngForm" novalidate>

            <!-- FIRST NAME -->
            <div class="mb-3">
                <label for="firstName" class="form-label">First Name *</label>
                <input type="text" id="firstName" [(ngModel)]="patient.firstName" name="firstName" #firstName="ngModel"
                    required minlength="4" class="form-control"
                    [class.is-invalid]="(firstName.invalid && (firstName.dirty || firstName.touched)) || (submitted && firstName.invalid)" />
                <div class="invalid-feedback" *ngIf="firstName.errors?.['required']">
                    First Name is required.
                </div>
                <div class="invalid-feedback" *ngIf="firstName.errors?.['minlength']">
                    Must be at least 4 characters.
                </div>
            </div>

            <!-- LAST NAME -->
            <div class="mb-3">
                <label for="lastName" class="form-label">Last Name *</label>
                <input type="text" id="lastName" [(ngModel)]="patient.lastName" name="lastName" #lastName="ngModel"
                    required minlength="4" class="form-control"
                    [class.is-invalid]="(lastName.invalid && (lastName.dirty || lastName.touched)) || (submitted && lastName.invalid)" />
                <div class="invalid-feedback" *ngIf="lastName.errors?.['required']">
                    Last Name is required.
                </div>
                <div class="invalid-feedback" *ngIf="lastName.errors?.['minlength']">
                    Must be at least 4 characters.
                </div>
            </div>

            <!-- GENDER -->
            <div class="mb-3">
                <label class="form-label d-block">Gender *</label>

                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="genderMale" name="gender" value="Male"
                        [(ngModel)]="patient.gender" #gender="ngModel" required />
                    <label class="form-check-label" for="genderMale">Male</label>
                </div>

                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="genderFemale" name="gender" value="Female"
                        [(ngModel)]="patient.gender" required />
                    <label class="form-check-label" for="genderFemale">Female</label>
                </div>

                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" id="genderOther" name="gender" value="Other"
                        [(ngModel)]="patient.gender" required />
                    <label class="form-check-label" for="genderOther">Other</label>
                </div>

                <!-- Always positioned after radios -->
                <div class="invalid-feedback d-block"
                    *ngIf="(gender.invalid && (gender.dirty || gender.touched)) || (submitted && gender.invalid)">
                    Gender is required.
                </div>
            </div>



            <!-- DOB -->
            <div class="mb-3">
                <label for="dob" class="form-label">Date of Birth *</label>
                <input type="date" id="dob" [(ngModel)]="patient.dob" name="dateOfBirth" #dob="ngModel" required
                    (change)="checkDOB()" class="form-control"
                    [class.is-invalid]="(dob.invalid && (dob.dirty || dob.touched)) || (submitted && dob.invalid) || dobFutureError" />
                <div class="invalid-feedback" *ngIf="dob.errors?.['required']">
                    Date of Birth is required.
                </div>
                <div class="invalid-feedback" *ngIf="dobFutureError">
                    Date of Birth cannot be in the future.
                </div>
            </div>

            <!-- PHONE -->
            <div class="mb-3">
                <label for="phone" class="form-label">Phone *</label>
                <input type="tel" id="phone" [(ngModel)]="patient.contact" name="phone" #phone="ngModel" required
                    pattern="^[6-9][0-9]{9}$" (input)="validatePhone()" class="form-control"
                    [class.is-invalid]="(phone.invalid && (phone.dirty || phone.touched)) || (submitted && phone.invalid)" />
                <div class="invalid-feedback" *ngIf="phone.errors?.['required']">
                    Phone number is required.
                </div>
                <div class="invalid-feedback" *ngIf="phone.errors?.['pattern']">
                    Must be 10 digits starting with 6–9.
                </div>
            </div>

            <!-- EMERGENCY NUMBER -->
            <div class="mb-3">
                <label for="emergency" class="form-label">Emergency Number *</label>
                <input type="tel" id="emergency" [(ngModel)]="patient.emergencyNumber" name="emergencyNumber"
                    #emergency="ngModel" required pattern="^[6-9][0-9]{9}$" (input)="validateEmergency()"
                    class="form-control"
                    [class.is-invalid]="((emergency.invalid && (emergency.dirty || emergency.touched)) || emergencySameError) || (submitted && emergency.invalid)" />
                <div class="invalid-feedback" *ngIf="emergency.errors?.['required']">
                    Emergency Number is required.
                </div>
                <div class="invalid-feedback" *ngIf="emergency.errors?.['pattern']">
                    Must be 10 digits starting with 6–9.
                </div>
                <div class="invalid-feedback" *ngIf="emergencySameError">
                    Must be different from Phone number.
                </div>
            </div>

            <!-- EMAIL -->
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" id="email" [(ngModel)]="patient.email" name="email" #email="ngModel"
                    class="form-control"
                    [class.is-invalid]="(email.invalid && (email.dirty || email.touched)) || (submitted && email.invalid)" />
                <div class="invalid-feedback">
                    Please enter a valid email address.
                </div>
            </div>

            <!-- ADDRESS -->
            <div class="mb-3">
                <label for="address" class="form-label">Address</label>
                <textarea id="address" [(ngModel)]="patient.address" name="address" rows="3"
                    class="form-control"></textarea>
            </div>

            <!-- BLOOD GROUP -->
            <div class="mb-3">
                <label for="bloodGroup" class="form-label">Blood Group *</label>
                <select id="bloodGroup" [(ngModel)]="patient.bloodGroup" name="bloodGroup" #bloodGroup="ngModel"
                    required class="form-select"
                    [class.is-invalid]="(bloodGroup.invalid && (bloodGroup.dirty || bloodGroup.touched)) || (submitted && bloodGroup.invalid)">
                    <option value="" disabled>Select Blood Group</option>
                    <option>A+</option>
                    <option>A-</option>
                    <option>B+</option>
                    <option>B-</option>
                    <option>AB+</option>
                    <option>AB-</option>
                    <option>O+</option>
                    <option>O-</option>
                </select>
                <div class="invalid-feedback">
                    Blood Group is required.
                </div>
            </div>

            <!-- ACTIONS -->
            <button type="submit" class="btn btn-primary" [disabled]="isSubmitting">
                {{ isSubmitting ? 'Saving...' : 'Add Patient' }}
            </button>
            <button type="button" class="btn btn-secondary ms-2" (click)="cancel()">
                Cancel
            </button>

            <!-- MESSAGES -->
            <div class="text-success mt-3" *ngIf="successMessage">{{ successMessage }}</div>
            <div class="text-danger mt-3" *ngIf="errorMessage">{{ errorMessage }}</div>
        </form>
    </div>
</div>