<div class="container my-4">

  <h2 class="mb-4 text-center">Pharmacist Dashboard</h2>

  <div *ngIf="alertMessage" class="alert" [ngClass]="{'alert-success': alertType==='success', 'alert-danger': alertType==='danger'}" role="alert">
    {{ alertMessage }}
  </div>

  <!-- Add Medicine -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white">Add Medicine</div>
    <div class="card-body">
      <form (ngSubmit)="addMedicine()">
        <div class="row g-3">
          <div class="col-md-4">
            <label for="medName" class="form-label">Medicine Name</label>
            <input type="text" id="medName" class="form-control" [(ngModel)]="medicineModel.name" name="name" required>
          </div>
          <div class="col-md-4">
            <label for="medQty" class="form-label">Quantity</label>
            <input type="number" id="medQty" class="form-control" [(ngModel)]="medicineModel.quantity" name="quantity" required min="1">
          </div>
          <div class="col-md-4">
            <label for="medPrice" class="form-label">Price</label>
            <input type="number" id="medPrice" class="form-control" [(ngModel)]="medicineModel.price" name="price" required min="0" step="0.01">
          </div>
        </div>
        <button type="submit" class="btn btn-success mt-3">Add Medicine</button>
      </form>
    </div>
  </div>

  <!-- View Medicines -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-info text-white">All Medicines</div>
    <div class="card-body table-responsive">
      <table class="table table-bordered table-hover">
        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Quantity</th>
            <th>Price</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let med of medicines">
            <td>{{ med.id }}</td>
            <td>{{ med.name }}</td>
            <td>{{ med.quantity }}</td>
            <td>{{ med.price | currency:'INR' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Prescriptions -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-secondary text-white">Prescriptions</div>
    <div class="card-body">
      <ul class="list-group mb-3">
        <li *ngFor="let presc of prescriptions" class="list-group-item d-flex justify-content-between align-items-center">
          Prescription #{{ presc.id }} for Patient #{{ presc.patientId }}
          <button class="btn btn-sm btn-primary" (click)="viewPrescription(presc.id)">View Details</button>
        </li>
      </ul>

      <div *ngIf="selectedPrescription" class="border p-3 rounded bg-light">
        <h5>Prescription Details (ID: {{ selectedPrescription.id }})</h5>
        <p><strong>Patient ID:</strong> {{ selectedPrescription.patientId }}</p>
        <p><strong>Doctor ID:</strong> {{ selectedPrescription.doctorId }}</p>
        <p><strong>Date:</strong> {{ selectedPrescription.date | date }}</p>
        <h6>Medicines:</h6>
        <ul>
          <li *ngFor="let med of selectedPrescription.medicines">
            {{ med.name }} - Qty: {{ med.quantity }} - Price: {{ med.price | currency:'INR' }}
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Patient History -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-warning text-dark">Patient History</div>
    <div class="card-body">
      <form (ngSubmit)="getPatientHistory(patientIdInput.value)">
        <div class="input-group mb-3">
          <input #patientIdInput type="number" class="form-control" placeholder="Enter Patient ID" required min="1">
          <button class="btn btn-outline-warning" type="submit">Get History</button>
        </div>
      </form>
      <pre *ngIf="patientHistory">{{ patientHistory | json }}</pre>
    </div>
  </div>

  <!-- Generate Pharmacy Bill -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-success text-white">Generate Pharmacy Bill</div>
    <div class="card-body">
      <form (ngSubmit)="generateBill()">
        <div class="row g-3">
          <div class="col-md-4">
            <label for="billPatientId" class="form-label">Patient ID</label>
            <input type="number" id="billPatientId" class="form-control" [(ngModel)]="billModel.patientId" name="patientId" required min="1">
          </div>
          <div class="col-md-4">
            <label for="billPrescriptionId" class="form-label">Prescription ID</label>
            <input type="number" id="billPrescriptionId" class="form-control" [(ngModel)]="billModel.prescriptionId" name="prescriptionId" required min="1">
          </div>
          <div class="col-md-4">
            <label for="billAmount" class="form-label">Amount</label>
            <input type="number" id="billAmount" class="form-control" [(ngModel)]="billModel.amount" name="amount" required min="0" step="0.01">
          </div>
        </div>
        <button type="submit" class="btn btn-success mt-3">Generate Bill</button>
      </form>
    </div>
  </div>

  <!-- Issue Medicine -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-danger text-white">Issue Medicine</div>
    <div class="card-body">
      <form (ngSubmit)="issueMedicine()">
        <div class="input-group">
          <input type="number" class="form-control" placeholder="Prescribed Medicine ID" [(ngModel)]="issueMedicineId" name="prescribedMedicineId" required min="1">
          <button class="btn btn-danger" type="submit">Issue</button>
        </div>
      </form>
    </div>
  </div>

</div>
