<app-navigation-bar></app-navigation-bar>

<!-- Search & Add Button Row -->
<div class="page-content">

  <!-- <h2 *ngIf="role" class="text-white mb-4">List Of {{ role }}</h2> -->

  <!-- Search bar (left) + Add/Back buttons (right) in a flex row -->
  <div class=" center-container mb-3 ">

    <!-- Search Box (left side of row) -->
    <div class="col-sm-6 p-0">
      <input type="search" placeholder="Search the Employee" class="form-control" [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchChange()">
    </div>

    <!-- Add and Back Buttons (right side of row) -->
    <div class="d-flex btn-back">
      <button *ngIf="role" class="btn btn-light-navy" (click)="role === 'Doctor' ? addDoctor() : addStaff(role)">
        <i class="fa fa-user-plus fa-lg"></i>
        Add {{ role }}
      </button>

      <button class="btn btn-secondary btn-back ms-3" (click)="goBack()">
        <i class="fa fa-arrow-left"></i>
        Back
      </button>
    </div>

  </div>

  <!-- Data Table -->
  <div class="center-container mb-3">
    <div class="center-narrow">
      <table class="table table-hover" *ngIf="role !== 'Doctor' || (role === 'Doctor' && !showDepartments)">
        <thead class="table-light">
          <tr>
            <th>Full Name</th>
            <th>Gender</th>
            <th>Email</th>
            <th>Contact</th>
            <th *ngIf="role === 'Doctor'">Department</th>
            <th>Blood Group</th>
            <th>Username</th>
            <th>Password</th>
            <th>Status</th>
            <th style="width:120px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers | paginate: { itemsPerPage: pageSize, currentPage: page }">
            <td>{{ user.fullName || (user.firstName + ' ' + user.lastName) || 'N/A' }}</td>
            <td>{{ user.gender }}</td>
            <td>{{ user.email || 'N/A' }}</td>
            <td>{{ user.contact || 'N/A' }}</td>
            <td *ngIf="role === 'Doctor'">
              {{ getDepartmentNameById(user.departmentId) || 'N/A' }}
            </td>
            <td>{{ user.bloodGroup || 'N/A' }}</td>
            <td>{{ user.username }}</td>
            <td>
              <span *ngIf="passwordVisibility[user.userId]; else maskedPassword">
                {{ user.password }}
              </span>
              <ng-template #maskedPassword>
                &#9679;&#9679;&#9679;&#9679;&#9679;&#9679;
              </ng-template>
              <button type="button" class="btn btn-link btn-sm p-0 ms-2" (click)="togglePasswordVisibility(user.userId)"
                [attr.aria-label]="passwordVisibility[user.userId] ? 'Hide Password' : 'Show Password'"
                title="{{ passwordVisibility[user.userId] ? 'Hide Password' : 'Show Password' }}">
                <i class="fa" [ngClass]="passwordVisibility[user.userId] ? 'fa-eye-slash' : 'fa-eye'"></i>
              </button>
            </td>
            <td>
              <span [class]="user.isActive ? 'badge bg-success' : 'badge bg-secondary'">
                {{ user.isActive ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td>
              <button class="btn btn-sm btn-outline-warning" (click)="editStaff(user.userId)">
                <i class="fa fa-edit"></i>
              </button>
              &nbsp;
              <button class="btn btn-sm btn-outline-danger" (click)="softDeleteStaff(user.userId)">
                <i class="fa fa-trash"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="filteredUsers.length === 0">
            <td [attr.colspan]="role === 'Doctor' ? 10 : 9" class="text-center text-muted">
              No users found.
            </td>
          </tr>
        </tbody>
      </table>
      <!-- </div> -->
    </div>
  </div>

  <!-- Pagination Footer -->
  <div class="footer-pagination ">
    <pagination-controls (pageChange)="page = $event" class="custom-page">
    </pagination-controls>
  </div>